<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Administration â€“ Planning</title>

<style>
*{box-sizing:border-box}

body{
    margin:0;
    font-family:Segoe UI, Arial, sans-serif;
    background:#f2f4f7;
    color:#1a2b44;
}

/* HEADER */
.header{
    background:#1e5fa8;
    color:white;
    padding:18px 32px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:20px;
    font-weight:600;
}

/* PAGE */
.page{
    padding:28px;
    display:flex;
    flex-direction:column;
    gap:26px;
}

/* GENERIC BOX */
.box{
    background:white;
    border-radius:14px;
    padding:22px;
    box-shadow:0 6px 20px rgba(0,0,0,.06);
}

.box h2{
    margin:0 0 16px 0;
    font-size:20px;
    color:#1e5fa8;
}

/* IMPORT */
.import-actions{
    display:flex;
    justify-content:space-between;
    gap:16px;
    margin-bottom:18px;
}

.btn{
    padding:10px 18px;
    border:none;
    border-radius:8px;
    font-size:14px;
    cursor:pointer;
    background:#1e5fa8;
    color:white;
    text-decoration:none;
}

.btn.green{background:#0a8f55}
.btn.red{background:#d13c3c}

.upload{
    border:2px dashed #1e5fa8;
    border-radius:10px;
    padding:24px;
    text-align:center;
    margin-bottom:16px;
}

/* GRID 2 COLS */
.two-cols{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:26px;
}

/* LISTS */
.list{
    display:flex;
    flex-direction:column;
    gap:10px;
}

.row{
    display:flex;
    justify-content:space-between;
    background:#f7faff;
    padding:10px 14px;
    border-radius:8px;
    font-size:14px;
}

.ok{color:#0a8f55;font-weight:600}
.ko{color:#d13c3c;font-weight:600}

/* ACCESS */
.access-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
}

.access-item{
    background:#f7faff;
    padding:8px 12px;
    border-radius:8px;
    display:flex;
    gap:8px;
    align-items:center;
    cursor:pointer;
}

/* EFFECTIFS */
.effectifs-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
    gap:14px;
}

.effectif{
    display:flex;
    justify-content:space-between;
    background:#f7faff;
    padding:10px 14px;
    border-radius:8px;
}

.effectif input{
    width:70px;
    padding:4px;
    text-align:center;
}

/* ===== SECTION ADMIN LARGE ===== */
.admin-section {
    width: 100%;
    background: #ffffff;
    padding: 24px 32px;
    border-radius: 16px;
    box-shadow: 0 8px 22px rgba(0,0,0,0.12);
    margin-top: 30px;
}

.admin-section h3 {
    margin: 0 0 18px 0;
    font-size: 22px;
    font-weight: 700;
    color: #1e3a8a;
}

/* ===== ROW FLEX ===== */
.admin-row {
    display: flex;
    gap: 20px;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
}

/* ===== INLINE FORM ===== */
.admin-form-inline {
    display: flex;
    gap: 16px;
    align-items: center;
    flex: 1;
}

/* ===== FILE INPUT ===== */
.file-input {
    flex: 1;
    position: relative;
}

.file-input input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
}

.file-input span {
    display: block;
    padding: 14px;
    border: 2px dashed #94a3b8;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
    color: #475569;
    transition: 0.2s ease;
}

.file-input:hover span {
    background: #f1f5f9;
    border-color: #2563eb;
    color: #1e40af;
}

/* ===== BUTTONS ===== */
.btn {
    padding: 14px 22px;
    border-radius: 12px;
    border: none;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    white-space: nowrap;
    transition: transform .15s ease, box-shadow .15s ease;
}

.btn:active {
    transform: scale(0.97);
}

.btn-primary {
    background: linear-gradient(135deg, #2563eb, #1e40af);
    color: white;
    box-shadow: 0 6px 16px rgba(37,99,235,.35);
}

.btn-primary:hover {
    box-shadow: 0 10px 22px rgba(37,99,235,.5);
}

.btn-danger {
    background: linear-gradient(135deg, #dc2626, #991b1b);
    color: white;
    box-shadow: 0 6px 16px rgba(220,38,38,.35);
}

.btn-danger:hover {
    box-shadow: 0 10px 22px rgba(220,38,38,.5);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 900px) {
    .admin-row {
        flex-direction: column;
        align-items: stretch;
    }

    .admin-form-inline {
        flex-direction: column;
    }
}

</style>
</head>

<body>

    <div style="text-align:right; margin-bottom:20px;">
    <a href="/logout" style="
        padding:8px 15px;
        background:#0b6268;
        color:white;
        text-decoration:none;
        border-radius:6px;
        font-weight:600;">
        DÃ©connexion
    </a>
</div>


<div class="header">
    <div>Administration du planning</div>
    <div>
        AnnÃ©e :
        <select onchange="location.href='/changer_annee/'+this.value">
            {% for a in annees %}
            <option value="{{a}}" {% if a==annee %}selected{% endif %}>{{a}}</option>
            {% endfor %}
        </select>
    </div>
</div>

<div class="page">

<!-- IMPORT -->
<div class="box">
<section class="admin-section">
    <h3> Gestion des anniversaires</h3>

    <div class="admin-row">
        <form method="POST" action="/admin/import_anniversaires"
              enctype="multipart/form-data" class="admin-form-inline">

            <label class="file-input">
                <input type="file" name="anniversaires_csv" accept=".csv" required>
                <span>ðŸ“‚ SÃ©lectionner un fichier CSV</span>
            </label>

            <button type="submit" class="btn btn-primary">
                Importer les anniversaires
            </button>
        </form>

        <form method="POST" action="/admin/reset_anniversaires">
            <button type="submit" class="btn btn-danger"
                onclick="return confirm('Supprimer tous les anniversaires ?')">
                RÃ©initialiser
            </button>
        </form>
    </div>
</section>



    <h2>Importer un planning</h2>

    <div class="import-actions">
        <a class="btn {% if verrou.verrouille %}red{% endif %}" href="/toggle_verrou">
            {% if verrou.verrouille %}DÃ©verrouiller{% else %}Verrouiller{% endif %}
        </a>

        <a class="btn" href="/tv" target="_blank">Voir lâ€™Ã©cran TV</a>
        <a class="btn" href="/preview" target="_blank">
             PrÃ©visualiser les prochains cours
        </a>

    </div>

    <hr>

    <form method="post" enctype="multipart/form-data">
        <div class="upload">
            <input type="file" name="csv_file" required>
        </div>

        <button class="btn green" {% if verrou.verrouille %}disabled{% endif %}>
            Importer le planning
        </button>
    </form>
</div>

<form method="POST" action="/admin/reset_imports"
      onsubmit="return confirm('Confirmer la rÃ©initialisation ?');">

    <button style="
        background:#dc2626;
        color:white;
        padding:12px 24px;
        border:none;
        border-radius:8px;
        font-size:16px;
        cursor:pointer;">
         RÃ©initialiser les imports CSV
    </button>

</form>


<!-- FORMATIONS + ACCESS -->
<div class="two-cols">

<div class="box">
    <h2>Formations</h2>
    <div class="list">
        {% for f in rapport %}
        <div class="row">
            <span>{{ f.formation }}</span>
            <span class="{{ 'ok' if f.statut=='OK' else 'ko' }}">{{ f.statut }}</span>
        </div>
        {% endfor %}
    </div>
</div>

<div class="box">
    <h2>â™¿ AccessibilitÃ© fauteuil</h2>
    <form id="access-form" class="access-grid">
        {% for f in rapport %}
        <label class="access-item">
            <input type="checkbox" name="{{ f.formation }}" {% if access.get(f.formation) %}checked{% endif %}>
            {{ f.formation }}
        </label>
        {% endfor %}
    </form>
</div>

</div>

<!-- GESTION DES FORMATIONS -->
<div class="box">
    <h2>Gestion des formations</h2>

    <!-- AJOUT -->
    <form method="post" action="/formations/add" style="display:flex;gap:10px;margin-bottom:16px;">
        <input type="text" name="nom" placeholder="Nom de la formation" required>
        <input type="number" name="effectif" placeholder="Effectif" min="0" required>
        <button class="btn green">Ajouter</button>
    </form>

    <!-- LISTE -->
    <div class="list">
        {% for f in formations %}
        <div class="row">
            <span>{{ f.nom }} ({{ f.effectif }} Ã©lÃ¨ves)</span>

            <form method="post" action="/formations/delete" style="margin:0">
                <input type="hidden" name="nom" value="{{ f.nom }}">
                <button class="btn red">Supprimer</button>
            </form>
        </div>
        {% endfor %}
    </div>
</div>

</div>


<script>
document.querySelectorAll('#access-form input').forEach(cb=>{
    cb.addEventListener('change', ()=>{
        fetch("/accessibilite", {
            method: "POST",
            body: new FormData(document.getElementById("access-form"))
        }).then(()=>location.reload());
    });
});
</script>

</body>
</html>
